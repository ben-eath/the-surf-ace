<html>
<head>
</head>
<body>
  <div id="vel"> </div>
<script>

    
var shark_velocity = {'direction':0, 'depth':0};

var last_direction = 0;
var last_depth = 0;

var ws = new WebSocket("ws://10.0.3.138:3001");
var sendDepth = function() {
  ws.send(JSON.stringify({'fn': 'setDepth', 'args':{'depth':Math.round(shark_velocity.depth)}}));
};
var sendDirection = function() {
  ws.send(JSON.stringify({'fn': 'setDirection', 'args':{'direction':Math.round(shark_velocity.direction)}}));
};


ws.onopen = function (event) {
  window.addEventListener('deviceorientation', function(eventData) {
    // gamma is the left-to-right tilt in degrees, where right is positive
    shark_velocity.depth = eventData.gamma/180;
    // between -1 and 1

    // beta is the front-to-back tilt in degrees, where front is positive
    shark_velocity.direction = eventData.beta/90;
    // also between -1 and 1

    // alpha is the compass direction the device is facing in degrees
    var dir = eventData.alpha;

    // call our orientation event handler
    if (Math.abs(Math.round(shark_velocity.direction) - last_direction) > .6) {
      sendDirection();
      last_direction = Math.round(shark_velocity.direction);
    }
    if (Math.abs(Math.round(shark_velocity.depth) - last_depth) > .6) {
      sendDepth();
      last_depth = Math.round(shark_velocity.depth);
    }

    document.getElementById("vel").textContent = "dir: " + shark_velocity.direction.toString() + " dep: " + shark_velocity.depth.toString();

  }, false);

};
      

if (window.DeviceOrientationEvent) {
    console.log("DeviceOrientation is supported");
}


// Listen for the deviceorientation event and handle the raw data

    </script>
</body>
</html>
